<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Confetti Example</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .slide-in-fwd-center {
      animation: slide-in-fwd-center 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
    }
    @keyframes slide-in-fwd-center {
      0% {
        transform: translateZ(-1400px);
        opacity: 0;
      }
      100% {
        transform: translateZ(0);
        opacity: 1;
      }
    }
    .heartbeat {
      animation: heartbeat 1.5s ease-in-out infinite both;
    }
    @keyframes heartbeat {
      from {
        transform: scale(1);
        transform-origin: center center;
        animation-timing-function: ease-out;
      }
      10%,
      20% {
        transform: scale(0.91);
        animation-timing-function: ease-in;
      }
      30% {
        transform: scale(0.98);
        animation-timing-function: ease-out;
      }
      40% {
        transform: scale(0.87);
        animation-timing-function: ease-in;
      }
      50% {
        transform: scale(1);
        animation-timing-function: ease-out;
      }
      100% {
        transform: scale(1);
        animation-timing-function: ease-out;
      }
    }
    /* Additional styles for layout */
    body {
      height: 100vh;
      background: #fbf223;
    }
    #wheel {
      width: 100px; /* Adjust the size as needed */
      height: 100px;
    }
    #arrow {
      width: 50px; /* Adjust the size as needed */
      height: 50px;
    }
    .mydiv {
      padding: 20px; /* Adjust as needed for spacing */
    }
    .wrapper {
      max-width: 100%; /* Ensures it doesn't exceed the container */
    }
    #tigerContainer {
      margin-left: -5%;
    }
    #secondPage {
      display: none;
    }
    .fade-out {
      animation: fade-out 1s ease-out both;
    }
    @keyframes fade-out {
      0% {
        opacity: 1;
      }
      100% {
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <img src="img/logo.png">
  </div>

  <div id="initialPage" class="container">
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-6">
          <div class="row">
            <div class="col-sm-8">
              <div class="wrapper">
                <div class="mydiv text-center">
                  <div class="d-flex justify-content-center align-items-center">
                    <canvas id="wheel"></canvas>
                    <img id="arrow" src="img/spinner-arrow-.svg" alt="spinner-arrow" class="ml-2" />
                  </div>
                  <br>
                  <button id="spin-btn" class="btn btn-lg btn-primary">Try your Luck</button>
                </div>
              </div>
            </div>
            <div id="tigerContainer" class="col-sm-4 pt-5 mt-5 d-none d-lg-block">
              <img src="img/tiger.png" alt="Tiger">
            </div>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="text-end">
            <img class="img-fluid" src="img/banner.png">
            <br>
            <img class="img-fluid" src="img/lottery.png">
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="secondPage" class="slide-in-fwd-center">
    <div class="text-center">
      <div class="heartbeat" id="final-value"></div>
      <a class="btn btn-success" href="#">Click Here to claim</a>
    </div>
  </div>

  <!-- Chart JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <!-- Chart JS Plugin for displaying text over chart -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.1.0/chartjs-plugin-datalabels.min.js"></script>
  <!-- Confetti JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/canvas-confetti/1.5.0/confetti.browser.min.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Custom JS -->
  <script>
    // Create a confetti burst function
    function confettiBurst() {
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Trigger the confetti burst when the page loads
      confettiBurst();
      // Set up an interval to trigger confetti burst periodically
      setInterval(confettiBurst, 2000); // Adjust the interval time as needed
    });

    // Spinner code
    var imgElement = '<img src="img/lottery.png" alt="Tiger Wheel">';
    var initialPage = document.getElementById('initialPage');
    var secondPage = document.getElementById('secondPage');
    const wheel = document.getElementById("wheel");
    const spinBtn = document.getElementById("spin-btn");
    const finalValue = document.getElementById("final-value");
    // Object that stores values of minimum and maximum angle for a value
    const rotationValues = [
      { minDegree: 0, maxDegree: 30, value: 2 },
      { minDegree: 31, maxDegree: 90, value: 1 },
      { minDegree: 91, maxDegree: 150, value: 6 },
      { minDegree: 151, maxDegree: 210, value: 5 },
      { minDegree: 211, maxDegree: 270, value: 4 },
      { minDegree: 271, maxDegree: 330, value: 3 },
      { minDegree: 331, maxDegree: 360, value: 2 },
    ];
    // Size of each piece
    const data = [16, 16, 16, 16, 16, 16];
    // Background color for each piece
    var pieColors = [
      "#cfc804",
      "#ffffff",
      "#cfc804",
      "#ffffff",
      "#cfc804",
      "#ffffff",
      "#cfc804",
      "#ffffff"
    ];
    // Create chart
    let myChart = new Chart(wheel, {
      // Plugin for displaying text on pie chart
      plugins: [ChartDataLabels],
      // Chart Type Pie
      type: "pie",
      data: {
        // Labels(values which are to be displayed on chart)
        labels: ["Tesla", "$50 shares", "1 BTC", "$100", "Tiger", "Lion is the king"],
        // Settings for dataset/pie
        datasets: [
          {
            backgroundColor: pieColors,
            data: data,
          },
        ],
      },
      options: {
        // Responsive chart
        responsive: true,
        borderColor: "black",
        maintainAspectRatio: true,
        animation: { duration: 10 },
        plugins: {
          // Hide tooltip and legend
          title: {
            align: "center"
          },
          tooltip: false,
          legend: {
            display: false,
          },
          // Display labels inside pie chart
          datalabels: {
            color: "black",
            formatter: (_, context) => context.chart.data.labels[context.dataIndex],
          },
        },
      },
    });
    // Display value based on the randomAngle
    const valueGenerator = (angleValue) => {
      for (let i of rotationValues) {
        // If the angleValue is between min and max then display it
        if (angleValue >= i.minDegree && angleValue <= i.maxDegree) {
          finalValue.innerHTML = `<p>Congratulations you have won: <br> <b>50 tesla shares</b> </p>` + imgElement;
          initialPage.classList.add('fade-out');

          // Hiding initial page and showing the next one
          setTimeout(function() {
            secondPage.style.display = "block";
            initialPage.style.display = "none";
            confettiBurst();
            setInterval(confettiBurst, 2000); // Adjust the interval time as needed
          }, 1000); // duration of fade-out animation
          break;
        }
      }
    };
    // Spinner count
    let count = 0;
    // 100 rotations for animation and last rotation for result
    let resultValue = 101;
    // Start spinning
    spinBtn.addEventListener("click", () => {
      spinBtn.disabled = true;
      // Empty final value
      finalValue.innerHTML = `<p>Congratulations you have won: <br> <b>50 tesla shares</b> </p>` + imgElement;
      // Generate random degrees to stop at
      let randomDegree = Math.floor(Math.random() * (355 - 0 + 1) + 0);
      // Interval for rotation animation
      let rotationInterval = window.setInterval(() => {
        // Set rotation for piechart
        myChart.options.rotation = myChart.options.rotation + resultValue;
        // Update chart with new value;
        myChart.update();
        // If rotation > 360 reset it back to 0
        if (myChart.options.rotation >= 360) {
          count += 1;
          resultValue -= 5;
          myChart.options.rotation = 0;
        } else if (count > 15 && myChart.options.rotation == randomDegree) {
          valueGenerator(randomDegree);
          clearInterval(rotationInterval);
          count = 0;
          resultValue = 101;
        }
      }, 10);
    });
  </script>
</body>
</html>
